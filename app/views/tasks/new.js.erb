<% today_tasks = today_task(nil, @task.task_date, current_user) %>
<% completed_tasks = today_tasks.completed_tasks %>
$('#progress_<%= @task.task_date %>').html('<%= escape_javascript(render(:partial => "todos/progress_container", :locals => {f: nil, key: @task.task_date, user: current_user, today_tasks: today_tasks, completed_tasks: completed_tasks  }))%>');
<%= puts "CUREENTTTTTTTTTT", current_user.tasks.active_tasks.current_tasks(@task.task_date).count %>
$("#progress_loader_<%= @task.task_date %>").empty().removeData().attr('data-percent', '<%= completed_percentage(today_tasks, completed_tasks) %>').circliful({
    animationStep: 5,
    foregroundBorderWidth: 70,
    backgroundBorderWidth: 70,
    foregroundColor: '#5fb760',
    backgroundColor: '#ededed',
    noPercentageSign: true,
    fontColor: '#fff'
});
$('#progress_loader_<%= @task.task_date %>').children("svg").eq(0).children("circle").eq(1).css("stroke-dasharray", '<%= completed_percentage(today_tasks, completed_tasks)*3.6 %>' + ", 20000");

$('#sortable<%= @task.task_date %>').append('<%= escape_javascript(render(:partial => "todos/task", :locals => {key: @task.task_date, task: @task }))%>');
$('#sortable<%= @task.task_date %>').children('li:visible').last().find('div').focus();

if ($('#sortable<%= @task.task_date %>').children('li:visible').length == 1 && $('#thoughts<%= @task.task_date %>').children('li:visible').length == 1) {
  $('#thoughts<%= @task.task_date %>').children('li:visible').last().removeClass('bt-0')
  $('#thoughts<%= @task.task_date %>').children('li:visible').last().css('border-top', '1px solid #ddd')
  $('#sortable<%= @task.task_date %>').children('li:visible').last().removeClass('bt-1')
}

if ($('#sortable<%= @task.task_date %>').children('li:visible').length == 1 && $('#thoughts<%= @task.task_date %>').children('li:visible').length == 0) {
  $('#sortable<%= @task.task_date %>').children('li:visible').last().removeClass('bt-1')
}
debugger
var tagAutocompleter = $.MentionsKinder.Autocompleter.Select2Autocompleter.extend({
  select2Options: {
    tags: JSON.parse($('#rails_tags').attr('data-tags'))
  }
});

$('li#task_<%= @task.id%>').find('.tags').mentionsKinder({
  trigger: {
    '#': {
      triggerName: 'tag',
      autocompleter: tagAutocompleter
    }
  }
})
console.log('clicked')

