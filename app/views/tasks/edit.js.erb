<% if @task.present? %>
	$('li#task_<%= @task.id%>').html('<%= escape_javascript(render(:partial => "todos/task_detail", :locals => {key: @task.task_date, task: @task }))%>');
	tags = '<%= current_user.tags.present? ? current_user.tags.map(&:title) : [] %>';
	tags = tags.replace(/&quot;/g, '"')	
	$('#rails_tags').attr('data-tags', tags);

	var tagAutocompleter = $.MentionsKinder.Autocompleter.Select2Autocompleter.extend({
		select2Options: {
		  tags: JSON.parse(tags)
		}
	});
	initializeAutocompleter('<%= @task.id %>', tagAutocompleter)
	// debugger
	p = document.getElementById('task_'+task_id).getElementsByTagName('div')[2]
	// s = window.getSelection()
	// r = document.createRange()
	// r.setStart(p, p.childElementCount)
	// r.setEnd(p, p.childElementCount)
	// s.removeAllRanges()
	// s.addRange(r)
	p.focus()
	// $('li#task_<%= @task.id%>').find('div.title').active();
<% end %>